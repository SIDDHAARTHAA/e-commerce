- name: Deploy to EC2
        run: |
          ssh -4 \
            -o StrictHostKeyChecking=no \
            -o UserKnownHostsFile=/dev/null \
            -o ConnectTimeout=10 \
            ${{ secrets.EC2_USER }}@${{ secrets.EC2_HOST }} << 'EOF'
              set -e

              export NVM_DIR="$HOME/.nvm"
              [ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

              cd /home/ubuntu/e-commerce

              echo "Pulling latest code..."
              git pull origin main

              echo "Installing dependencies..."
              npm ci

              echo "Building app..."
              npm run build

              echo "Reloading PM2 app..."
              pm2 reload e-commerce

              echo "Deploy complete."
          EOF